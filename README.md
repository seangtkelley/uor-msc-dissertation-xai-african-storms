# Using machine learning to predict the intensification and propagation of East African storms

## Metadata
- **University**: [University of Reading](https://www.reading.ac.uk/)
- **Master's Program**: [MSc Climate Change and Artificial Intelligence (CCAI)](https://www.reading.ac.uk/ready-to-study/study/2025/meteorology-and-climate-pg/msc-climate-change-and-artificial-intelligence) 2024-2025 
- **Student**: Sean Kelley
- **Primary Supervisor**: [Eliza Karlowska](https://research.reading.ac.uk/meteorology/people/eliza-karlowska/)
- **Co-supervisors**: [Kieran Hunt](https://research.reading.ac.uk/meteorology/people/kieran-hunt/), [Andy Turner](https://research.reading.ac.uk/meteorology/people/andrew-turner/)

## Folder Structure

For the instructions below, the use of `REPO_ROOT` will refer to the fully qualified directory path where the repository is cloned.

- `REPO_ROOT/`
  - `data`: Data files
  - `figures`: Figures and table files generated by code
  - `report`: Latex report files
  - `src`: Python code and Jupyter notebooks
  - `src/json_config`: JSON configuration files for model training
  - `models/run_*`: Trained model files

## Minimum Setup Instructions

The following instructions assume you have `python` installed.

### Conda

Recommended for complete python environment isolation.

1. [Install conda](https://docs.conda.io/projects/conda/en/latest/user-guide/install/index.html)
2. `conda env create -f environment.yml`
3. `conda activate uor-msc-dissertation-xai-african-storms`

### Venv

1. `pip install venv`
2. `python -m venv venv`
3. `source venv/bin/activate`
4. `pip install -r requirements.txt`

## Basic Usage Instructions

1. Adjust configuration in `src/config.py` as needed.
2. Create the dataset: `python src/create_dataset.py`
3. Train the model: 
  - Static hyperparameters: `python src/train_model.py`
  - Hyperparameter Sweep (requires `wandb`): `python src/train_model_sweep.py`

### Weights & Biases (W&B) setup
- Sign up for a free account at [wandb.ai](https://wandb.ai/site).
- Add your W&B API key to the environment:
  - dotenv file: Create a `.env` file in the root directory with the line `WANDB_API_KEY=your_api_key`
  - Command line: `export WANDB_API_KEY=your_api_key`
- Run either training scripts with W&B enabled using the `--wandb_mode online` flag

## Data Description

### Database of East African Mesoscale Convective Systems (MCSs)
- file: `East_Africa_tracked_MCSs_2014_2019_longer_than_3_hours.csv`
- 27,982 storms longer than 3 hours and that had all storm centroids along the track within (3-15N, 34-52E)

### ERA5 Data
- ERA5 data for 31-53E, 2-16N region for 2014-2019, in total 27 GB. The ERA5 area is wider by a few grid points for edge cases in the database + for calculating gradients

#### Folder Structure
- `raw/` - no data here, Eliza has all the preprocessed data on her own jasmin gsw
- `std/` - all preprocessed data is stored here, should be in the same format, some variables are on different grids (T vs U grid)
- `processed/` - I advise to save processed data in this directory, e.g. gradients etc so we don’t accidentally overwrite std/ data

#### Invariant Data:

| File Pattern | Description | Units/Notes |
|--------------|-------------|-------------|
| `geop.nc` | Geopotential | m²/s² (divide by 9.81 m/s to get orography) |
| `lsm.nc`  |  land-sea mask | Boolean |
| `anor.nc` | Angle of sub-gridscale orography | radians from E | 

#### Hourly data stored in yearly files:

| File Pattern | Description | Units/Notes |
|--------------|-------------|-------------|
| `cape_0_*.nc` | Convective available potential energy | J/kg |
| `olr_toa_*.nc` | Top-of-atmosphere outgoing longwave flux (proxy for convection/clouds) | W/m² |
| `prcp_tot_*.nc` | Thickness of rainfall amount (hourly accumulations) | m |
| `rhum_*_*.nc` | Relative humidity at 500, 750 and 900 hPa | % [was used for theta e calculations] |
| `shum_*_*.nc` | Specific humidity at 200, 500, 850 hPa | kg/kg |
| `skt_sfc_*.nc` | Surface temperature on land | K |
| `sst_sfc_*.nc` | Sea surface temperature | K |
| `swvl1_d1_*.nc` | Volumetric soil water layer 1 | m³/m³ |
| `swvl2_d2_*.nc` | Volumetric soil water layer 2 | m³/m³ |
| `ta_*_*.nc` | Air temperature at 500, 750 and 900 hPa | K [was used for theta e calculations] |
| `tcwv_tot_*.nc` | Thickness of atmosphere mass content of water vapour | kg/m² [total column water vapour] |
| `thetae_*_*.nc` | Equivalent potential temperature at 500, 750 and 900 hPa | K [first calculated dew point, then LCL temperature and finally theta e using metpy library] |
| `uwnd_*_*.nc` | Zonal wind at 200, 500 and 850 hPa | m/s |
| `vwnd_*_*.nc` | Meridional wind at 200, 500 and 850 hPa | m/s |

## Feature Description

Notes:
- The features are listed in the order they appear in the dataset calculated by `src/create_dataset.py`.
- All variables with the `storm_` prefix are valid over the entire MCS lifetime, while the others are valid only for the current time step.
- All variables with the `mean_` prefix are calculated over a 400 km radius square-area from the MCS centre and are instantaneous unless otherwise specified.

| Variable name | Description | Units |
|--------------|-------------|-------------|
| `storm_id` | Unique identifier for each MCS | - |
| `storm_obs_idx` | Observation index within MCS (0 for first observation, 1 for second, etc.) | - |
| `timestamp` | Datetime of observation | UTC |
| `date_angle` | Angle representation of current date within year | ° |
| `eat_hours` | Time step hour of day | [Eastern Africa Time](https://www.timeanddate.com/time/zones/eat) (UTC+3) |
| `storm_total_duration` | Total duration of MCS | h |
| `lon` | Longitude of MCS centre | ° E |
| `lat` | Latitude of MCS centre | ° N |
| `orography_height` | Elevation of land surface at MCS centre | m |
| `anor` | Angle of sub-gridscale orography at MCS centre | radians from E |
| `upslope_bearing` | Compass bearing of upslope direction at MCS centre | ° from N |
| `slope_angle` | Angle of slope at MCS centre | ° |
| `over_land` | Flag for MCS centre (True if MCS centre is over land, else False) | boolean |
| `acc_land_time` | Accumulated time where `over_land=True` | h |
| `storm_total_land_time` | Final value of `acc_land_time` for MCS | h |
| `mean_land_frac` | Fraction of area within 400 km that is over land | ratio ($[0,1]$) |
| `zonal_speed` | $x$-component of MCS centre propagation vector | km/h |
| `meridional_speed` | $y$-component of MCS centre propagation vector | km/h |
| `area` | Area of the MCS | km² |
| `storm_max_area` | Max value of `area` for MCS | km² |
| `bearing_from_prev` | Compass bearing from previous observation | ° from N |
| `bearing_to_next` | Compass bearing to next observation | ° from N |
| `distance_from_prev` | Distance traversed from previous observation | km |
| `distance_to_next` | Distance to next observation | km |
| `distance_traversed` | Cumulative sum of `distance_from_prev` | km |
| `storm_bearing` | Compass bearing from first to last MCS centre | ° from N |
| `storm_distance_traversed` | Total cumulative distance traversed by MCS centre | km |
| `storm_straight_line_distance` | Distance from first to last MCS centre | km |
| `mean_skt` | Surface temperature | K |
| `mean_land_skt` | Land surface temperature (NaN if entire area is ocean) | K |
| `mean_sst` | Sea surface temperature (NaN if entire area is land) | K |
| `mean_swvl1` | Volumetric soil moisture in the top layer (<7 cm; NaN over ocean) | m³/m³ |
| `mean_swvl2` | Volumetric soil moisture in the second layer (7–28 cm; NaN over ocean) | m³/m³ |
| `mean_u850` | 850 hPa zonal wind | m/s |
| `mean_u500` | 500 hPa zonal wind | m/s |
| `mean_u200` | 200 hPa zonal wind | m/s |
| `mean_v850` | 850 hPa meridional wind | m/s |
| `mean_v500` | 500 hPa meridional wind | m/s |
| `mean_v200` | 200 hPa meridional wind | m/s |
| `domain_mean_u500` | Mean 500 hPa zonal wind over the entire domain of ERA5 data | m/s |
| `mean_u_shear_850_500` | Shear of zonal wind from 850 and 500 hPa | m/s |
| `mean_v_shear_850_500` | Shear of meridional wind from 850 and 500 hPa | m/s |
| `mean_u_shear_850_200` | Shear of zonal wind from 850 and 200 hPa | m/s |
| `mean_v_shear_850_200` | Shear of meridional wind from 850 and 200 hPa | m/s |
| `wind_direction_850` | Compass bearing from which the 850 hPa wind vector at MCS centre originates | ° from N |
| `wind_angle_upslope` | Angle of `wind_direction_850` relative to `upslope_bearing` (wind is going upslope: 0, downslope: 180, cross-slope: 90,270) | ° from `upslope_bearing` |
| `mean_tcwv` | Total column water vapour (TCWV) | kg/m² |
| `domain_mean_tcwv` | Mean TCWV over the entire domain of ERA5 data | kg/m² |
| `mean_q_850` | 850 hPa specific humidity | kg/kg |
| `mean_q_500` | 500 hPa specific humidity | kg/kg |
| `mean_q_200` | 200 hPa specific humidity | kg/kg |
| `mean_cape` | Convective available potential energy (CAPE) | J/kg |
| `domain_mean_cape` | Mean CAPE over the entire domain of ERA5 data | J/kg |
| `olr_90` | 90th percentile of negative outgoing longwave radiation (OLR) within 400 km | W/m² |
| `olr_75` | 75th percentile of negative OLR within 400 km | W/m² |
| `olr_50` | 50th percentile of negative OLR within 400 km | W/m² |
| `mean_prcp_400` | Precipitation over the next 6 h | mm |
| `min_bt` | Minimum cloudtop brightness within MCS area | K |
| `dmin_bt_dt` | Rate of change of `min_bt` | K/h |
| `mean_bt` | Mean cloudtop brightness within MCS area | K |
| `dmean_bt_dt` | Rate of change of `mean_bt` | K/h |
| `storm_min_bt` | Minimum value of `min_bt` reached for MCS | K |
| `storm_min_bt_reached` | False if `storm_min_bt` has not been reached yet, else True | boolean |
| `mjo_phase` | Phase of Madden–Julian oscillation (MJO) | integer range from 1 to 8 |
| `mjo_amplitude` | Amplitude of MJO | - |
# Using machine learning to predict the intensification and propagation of East African storms

## Metadata
- **University**: [University of Reading](https://www.reading.ac.uk/)
- **Master's Program**: [MSc Climate Change and Artificial Intelligence (CCAI)](https://www.reading.ac.uk/ready-to-study/study/2025/meteorology-and-climate-pg/msc-climate-change-and-artificial-intelligence) 2024-2025 
- **Student**: Sean Kelley
- **Primary Supervisor**: [Eliza Karlowska](https://research.reading.ac.uk/meteorology/people/eliza-karlowska/)
- **Co-supervisors**: [Kieran Hunt](https://research.reading.ac.uk/meteorology/people/kieran-hunt/), [Andy Turner](https://research.reading.ac.uk/meteorology/people/andrew-turner/)

## Folder Structure

For the instructions below, the use of `REPO_ROOT` will refer to the fully qualified directory path where the repository is cloned.

- `REPO_ROOT/`
  - `data`: Data files
  - `figures`: Figures and table files generated by code
  - `report`: Latex report files
  - `src`: Python code and Jupyter notebooks
  - `src/json_config`: JSON configuration files for model training
  - `models/run_*`: Trained model files

## Minimum Setup Instructions

The following instructions assume you have `python` installed.

### Conda

Recommended for complete python environment isolation.

1. [Install conda](https://docs.conda.io/projects/conda/en/latest/user-guide/install/index.html)
2. `conda env create -f environment.yml`
3. `conda activate uor-msc-dissertation-xai-african-storms`

### Venv

1. `pip install venv`
2. `python -m venv venv`
3. `source venv/bin/activate`
4. `pip install -r requirements.txt`

## Basic Usage Instructions

1. Adjust configuration in `src/config.py` as needed.
2. Create the dataset: `python src/create_dataset.py`
3. Train the model: 
  - Static hyperparameters: `python src/train_model.py`
  - Hyperparameter Sweep (requires `wandb`): `python src/train_model_sweep.py`

### Weights & Biases (W&B) setup
- Sign up for a free account at [wandb.ai](https://wandb.ai/site).
- Add your W&B API key to the environment:
  - dotenv file: Create a `.env` file in the root directory with the line `WANDB_API_KEY=your_api_key`
  - Command line: `export WANDB_API_KEY=your_api_key`
- Run either training scripts with W&B enabled using the `--wandb_mode online` flag

## Data Description

### Storm Database
- file: `East_Africa_tracked_MCSs_2014_2019_longer_than_3_hours.csv`
- 27,982 storms longer than 3 hours and that had all storm centroids along the track within (3-15N, 34-52E)

### ERA5 Data
- ERA5 data for 31-53E, 2-16N region for 2014-2019, in total 27 GB. The ERA5 area is wider by a few grid points for edge cases in the database + for calculating gradients

#### Folder Structure
- `raw/` - no data here, Eliza has all the preprocessed data on her own jasmin gsw
- `std/` - all preprocessed data is stored here, should be in the same format, some variables are on different grids (T vs U grid)
- `processed/` - I advise to save processed data in this directory, e.g. gradients etc so we don’t accidentally overwrite std/ data

#### Invariant Data:

| File Pattern | Description | Units/Notes |
|--------------|-------------|-------------|
| `geop.nc` | Geopotential | m²/s² (divide by 9.81 m/s to get orography) |
| `lsm.nc`  |  land-sea mask | Boolean |
| `anor.nc` | Angle of sub-gridscale orography | radians | 

#### Hourly data stored in yearly files:

| File Pattern | Description | Units/Notes |
|--------------|-------------|-------------|
| `cape_0_*.nc` | Convective available potential energy | J/kg |
| `olr_toa_*.nc` | Top-of-atmosphere outgoing longwave flux (proxy for convection/clouds) | W/m² |
| `prcp_tot_*.nc` | Thickness of rainfall amount (hourly accumulations) | m |
| `rhum_*_*.nc` | Relative humidity at 500, 750 and 900 hPa | % [was used for theta e calculations] |
| `shum_*_*.nc` | Specific humidity at 200, 500, 850 hPa | kg/kg |
| `skt_sfc_*.nc` | Surface temperature on land | K |
| `sst_sfc_*.nc` | Sea surface temperature | K |
| `swvl1_d1_*.nc` | Volumetric soil water layer 1 | m³/m³ |
| `swvl2_d2_*.nc` | Volumetric soil water layer 2 | m³/m³ |
| `ta_*_*.nc` | Air temperature at 500, 750 and 900 hPa | K [was used for theta e calculations] |
| `tcwv_tot_*.nc` | Thickness of atmosphere mass content of water vapor | kg/m² [total column water vapor] |
| `thetae_*_*.nc` | Equivalent potential temperature at 500, 750 and 900 hPa | K [first calculated dewpoint, then LCL temperature and finally theta e using metpy library] |
| `uwnd_*_*.nc` | Zonal wind at 200, 500 and 850 hPa | - |
| `vwnd_*_*.nc` | Meridional wind at 200, 500 and 850 hPa | - |

## Feature Description

Notes:
- The features are listed in the order they appear in the dataset calculated by `src/create_dataset.py`.
- All variables with the `storm_` prefix are valid over the entire storm lifetime, while the others are valid only for the current time step.
- All variables with the `mean_` prefix are calculated over a 400 km radius square-area from the storm centre, **not** the storm area.

| Variable name | Description | Units | Predictor? | Predictand? |
|--------------|-------------|-------------|-------------|-------------|
| `storm_id` | Unique identifier for each storm | - | No | No |
| `timestamp` | Time of the storm centre | UTC | No | No |
| `eat_hours` | Time step hour of day | EAT (UTC +3) | Yes | No |
| `storm_total_duration` | Total duration of storm | hr | Yes | **Yes** |
| `lon` | Longitude of LPS centre | ° E | Yes | No |
| `lat` | Latitude of LPS centre | ° N | Yes | No |
| `orography_height` | Elevation of land surface under centre | m | Yes | No |
| `anor` | Angle of sub-gridscale orography | radians | Yes | No |
| `over_land` | Flag for LPS centre (True if storm centre is over land, else False) | boolean | Yes | No |
| `acc_land_time` | Accumulated time where `over_land=True` | hr | Yes | No |
| `storm_total_land_time` | Final value of `acc_land_time` for a given storm | hr | Yes | No |
| `mean_land_frac` | Fraction of area within 400 km that is over land | ratio | Yes | No |
| `mean_skt` | Surface temperature | K | Yes | No |
| `mean_land_skt` | Land surface temperature (NaN if entire area is ocean) | K | Yes | No |
| `mean_sst` | Sea surface temperature (NaN if entire area is land) | K | Yes | No |
| `zonal_speed` | $x$-component of LPS propagation vector | km/hr | Yes | No |
| `meridional_speed` | $y$-component of LPS propagation vector | km/hr | Yes | No |
| `area` | Area of the storm | km² | Yes | No |
| `storm_max_area` | Max value of `area` over storm | km² | Yes | No |
| `bearing_from_prev` | Compass bearing from previous point | ° | Yes | No |
| `distance_from_prev` | Distance traversed from previous point | km | Yes | No |
| `distance_traversed` | Cumulative sum of `distance_from_prev` | km | Yes | No |
| `storm_bearing` | Compass bearing from first to last point of storm | ° | Yes | No |
| `storm_distance_traversed` | Total cumulative distance traversed by storm | km | Yes | No |
| `storm_straight_line_distance` | Distance from first to last point of storm | km | Yes | No |
| `mean_prcp_400` | Mean precipitation over the next 6 hr | mm/hr | Yes | **Yes** |
| `min_bt` | Minimum cloudtop brightness within storm area | K | Yes | No |
| `dmin_bt_dt` | Rate of change of `min_bt` | K/6 hr | Yes | No |
| `mean_bt` | Mean cloudtop brightness within storm area | K | Yes | No |
| `dmean_bt_dt` | Rate of change of `mean_bt` | K/6 hr | Yes | No |
| `storm_min_bt` | Minimum value of `min_bt` reached by a storm | K | Yes | **Yes** |
| `storm_min_bt_reached` | False if `storm_min_bt` has not been reached yet, else True | boolean | Yes | No |
| `mjo_phase` | Phase of Madden–Julian oscillation | integer range from 1 to 8 | Yes | No |
| `mjo_amplitude` | Amplitude of Madden–Julian oscillation | - | Yes | No |
<!--
| mean_land_skt | Land surface temperature (NaN over ocean) | K |
| mean_dthetae_dp_900_750 | $ d\left(\mathsf{theta}\_\mathsf{e}\right)/ dp $ between 900 and 750 hPa | K/hPa |
| mean_dthetae_dp_750_500 | $ d\left(\mathsf{theta}\_\mathsf{e}\right)/ dp $ between 750 and 500 hPa | K/hPa |
| ushear_850 | Meridional shear of 850 hPa zonal wind over India | m/s deg |
-->